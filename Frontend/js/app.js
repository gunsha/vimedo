function appendModal(){var e,o=1;$(".modal").on("show.bs.modal",function(t){void 0===e||1==o&&t.target!=e?(e=t.target,o++,t.preventDefault(),$(t.target).appendTo("body").modal("show")):t.target==e&&2==o&&o--})}function indexService(e,o){function t(){return o.get(apiRoute+"/solicitudesMedicas").then(function(e){return e.data})}return{getSolicitudes:t}}function indexCtrl(e,o,t,n,i,a,r,s,l,c){function u(e,o){for(var t,n,i=0,a=0,r=0,s=[],l=0,c=0,u=null,d=Math.pow(10,o||5);i<e.length;){u=null,l=0,c=0;do{u=e.charCodeAt(i++)-63,c|=(31&u)<<l,l+=5}while(u>=32);t=1&c?~(c>>1):c>>1,l=c=0;do{u=e.charCodeAt(i++)-63,c|=(31&u)<<l,l+=5}while(u>=32);n=1&c?~(c>>1):c>>1,a+=t,r+=n,s.push({lat:a/d,lng:r/d})}return s}var d=this;d.googleMapsUrl="https://maps.googleapis.com/maps/api/js?key=AIzaSyA02b574ia3BpLXpDZXU2gOFuQZTfC_Kks",d.profesionales=[],d.profesionalesD=[],d.profesionalesOrig=[],d.solicitudes=[],d.solicitudesOrig=[],d.filterListS=function(){var e=d.queryS.toLowerCase();d.solicitudes=d.solicitudesOrig.filter(function(o){if(o.afiliado.personaFisica&&(-1!==o.afiliado.personaFisica.nroDocumento.toLowerCase().indexOf(e)||-1!==o.afiliado.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.afiliado.personaFisica.apellido.toLowerCase().indexOf(e)))return o})},d.filterListP=function(){var e=d.queryP.toLowerCase();d.profesionales=d.profesionalesOrig.filter(function(o){if(o.personaFisica&&(-1!==o.personaFisica.nroDocumento.toLowerCase().indexOf(e)||-1!==o.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.personaFisica.apellido.toLowerCase().indexOf(e))||-1!==o.matricula.toLowerCase().indexOf(e))return o})},d.filterListPD=function(){var e=d.queryPD.toLowerCase();d.profesionalesD=d.profesionalesOrig.filter(function(o){if(o.personaFisica&&(-1!==o.personaFisica.nroDocumento.toLowerCase().indexOf(e)||-1!==o.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.personaFisica.apellido.toLowerCase().indexOf(e))||-1!==o.matricula.toLowerCase().indexOf(e))return o})},d.centrarMapa=function(e,o){l.getMap("map").then(function(t){var n=new google.maps.LatLng(e,o);d.map.setCenter(n)})},d.centerAndZoom=function(){for(var e=new google.maps.LatLngBounds,o=0;o<d.latlngArray.length;o++)e.extend(d.latlngArray[o]);d.map.fitBounds(e)},d.ocultarInfoWindows=function(){for(var e=0;e<d.infowindows.length;e++)d.infowindows[e].close()},d.calcularRutaProfesional=function(e){n.calcularRutaProfesional(e).then(function(e){var o=e;l.getMap("map").then(function(e){for(var t=0;t<d.polylines.length;t++)d.polylines[t].setMap(null);d.polylines=[];for(var t=0;t<o.routes[0].legs.length;t++){for(var n=[],i=o.routes[0].legs[t],a=0;a<i.steps.length;a++)for(var r=i.steps[a],s=u(r.polyline.points),l=0;l<s.length;l++)n.push(s[l]);var c=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:f(),strokeOpacity:1,strokeWeight:2});d.polylines.push(c),c.setMap(e)}})})},d.initMap=function(){d.polylines=[],d.latlngArray=[],d.solicitudesMarks=[],d.profesionalMark=[],d.asignandoProfesional=!1,d.infowindows=[],n.listActive().then(function(e){d.solicitudes=e,d.solicitudesOrig=e,l.getMap("map").then(function(e){d.map=e;for(var o=0;o<d.solicitudes.length;o++){var t=d.solicitudes[o],n='<div id="content"><h5>'+t.afiliado.personaFisica.nombre+" "+t.afiliado.personaFisica.apellido+"</h5><div>"+t.domicilio.calle+" "+t.domicilio.numero+"</div><div>";0==t.estado&&(n+='<button type="button" class="btn btn-primary btn-xs" onclick="asignarProfesional(&quot;'+t._id+'&quot;)">Asignar Prestador</button></div>'),n+="</div>";var i=s(n)(d),a=new google.maps.InfoWindow({content:n});d.infowindows.push(a);var r;switch(t.estado){case 0:r=client+"/img/red-dot.png";break;case 1:r=client+"/img/green-dot.png"}var l=new google.maps.LatLng(t.domicilio.latitud,t.domicilio.longitud);d.latlngArray.push(l);var c=new google.maps.Marker({icon:r,estado:t.estado,solicitud:t});c.infowindow=a,c.addListener("click",function(){return this.infowindow.setContent(i),this.infowindow.open(e,this)}),c.setPosition(l),c.setMap(e),d.map.setCenter(l),d.solicitudesMarks.push(c)}d.cargarProfesionales()})})},d.cargarProfesionales=function(){i.getList().then(function(o){d.profesionales=o,d.profesionalesD=o,d.profesionalesOrig=o;for(var t=0;t<d.profesionalesOrig.length;t++){d.profesionalesOrig[t];var n=new google.maps.LatLng(d.profesionalesOrig[t].latitud,d.profesionalesOrig[t].longitud);d.latlngArray.push(n);var i=new google.maps.Marker({icon:client+"/img/doctor.png",profesional:d.profesionalesOrig[t]});i.addListener("click",function(){if(d.ocultarInfoWindows(),d.asignandoProfesional){var o='<div id="content"><h5>'+this.profesional.personaFisica.nombre+" "+this.profesional.personaFisica.apellido+'</h5><button type="button" class="btn btn-primary btn-xs" onclick="confirmarProfesional(&quot;'+this.profesional._id+'&quot;)">Aceptar</button></div>',t=s(o)(e),n=new google.maps.InfoWindow({content:o});return d.infowindows.push(n),this.infowindow=n,this.infowindow.setContent(t),this.infowindow.open(d.map,this)}var o='<div id="content"><h5>'+this.profesional.personaFisica.nombre+" "+this.profesional.personaFisica.apellido+"</h5></div>",t=s(o)(e),n=new google.maps.InfoWindow({content:o});return d.infowindows.push(n),this.infowindow=n,this.infowindow.setContent(t),d.calcularRutaProfesional(this.profesional._id),this.infowindow.open(d.map,this)}),i.setPosition(n),i.setMap(d.map),d.profesionalMark.push(i)}d.centerAndZoom()})},d.calcularRutaSolicitud=function(e){if(0===e.estado)return!1;n.calcularRutaSolicitud(e._id).then(function(e){var o=e;l.getMap("map").then(function(e){for(var t=0;t<d.polylines.length;t++)d.polylines[t].setMap(null);d.polylines=[];for(var t=0;t<o.routes[0].legs.length;t++){for(var n=[],i=o.routes[0].legs[t],a=0;a<i.steps.length;a++)for(var r=i.steps[a],s=u(r.polyline.points),l=0;l<s.length;l++)n.push(s[l]);var c=new google.maps.Polyline({path:n,geodesic:!0,strokeColor:f(),strokeOpacity:1,strokeWeight:2});d.polylines.push(c),c.setMap(e)}})})},d.asignarProfesional=function(e){d.ocultarInfoWindows(),l.getMap("map").then(function(o){d.solicitudId=e,d.asignandoProfesional=!0;for(var t=0;t<d.solicitudesMarks.length;t++){var n=d.solicitudesMarks[t];n.solicitud._id!=e&&n.setMap(null)}for(var t=0;t<d.polylines.length;t++){d.polylines[t].setMap(null)}d.polylines=[]})},d.vistaAsignarProfesional=function(e){d.solicitudId=e,d.queryP="",d.filterListP(),$("#modalPro").modal()},d.confirmarProfesional=function(e){d.ocultarInfoWindows();var o={solicitudMedica:{_id:d.solicitudId},profesional:{_id:e}};n.setProfesional(o).then(function(){$("#modalPro").modal("hide"),$(".collapse").collapse("hide"),d.initMap(),c.success("Profesional asignado.")})},d.finishSolicitud=function(e){d.solSel=e,swal({title:"Cerrar la solicitud?",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Aceptar"}).then(function(){swal.setDefaults({input:"text",confirmButtonText:"Siguiente &rarr;",showCancelButton:!0,animation:!0,progressSteps:["1","2"]});var e=[{title:"Indicaciones",text:"Indicaciones para el paciente"},{title:"Observaciones",text:"Obsrvaciones de la visita"}];swal.queue(e).then(function(e){swal.resetDefaults(),d.solSel.indicaciones=e[0],d.solSel.observaciones=e[1],n.finalizar(d.solSel).then(function(){swal({text:"La solicitud ha sido cerrada.",type:"success",showCancelButton:!1,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"}),d.initMap()},function(){swal({title:"Ocurrio un error.",text:"Intente mas tarde.",type:"error",showCancelButton:!1,confirmButtonColor:"#3085d6",confirmButtonText:"Aceptar"})})},function(){swal.resetDefaults()})})};var f=function(){for(var e="#",o=0;o<6;o++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e};d.newSolicitudModal="",d.newSol=function(){d.newSolicitud={sintomas:[],antecedentes:[]},$(d.newSolicitudModal).modal()},d.finishSaveSolicitud=function(){d.newSolicitud={sintomas:[],antecedentes:[]},d.initMap(),$(d.newSolicitudModal).modal("hide")}}function asignarProfesional(e){var o=angular.element("#accordion").scope();o&&o.ctrl&&o.ctrl.asignarProfesional(e)}function confirmarProfesional(e){var o=angular.element("#accordion").scope();o&&o.ctrl&&o.ctrl.confirmarProfesional(e)}function navService(e){return{}}function navCtrl(e,o,t,n,i,a){var r=this;r.logout=function(){o.user=!1},r.navigate=function(e){"app"!==a.name&&a.go("app"),$("html, body").animate({scrollTop:$("#"+e).offset().top-67},1e3)}}function authService(e,o){function t(e){return o({method:"POST",url:apiRoute+"/users/login",data:e,skipAuthorization:!0}).then(function(e){return e.data})}function n(e,t){return t?e.isProfesional=t:e.afiliado=e.personaFisica,o({method:"POST",url:apiRoute+"/users/register",data:e,skipAuthorization:!0}).then(function(e){return e.data})}function i(e){return o({method:"POST",url:apiRoute+"/api/auth/forgot",data:e,skipAuthorization:!0}).then(function(e){return e.data})}function a(e){return o({method:"POST",url:apiRoute+"/api/auth/resetPassword",data:e,skipAuthorization:!0}).then(function(e){return e.data})}return{login:t,reset:a,forgot:i,signUp:n}}function authCtrl(e,o,t,n,i,a,r,s){var l=this;l.wrongUserError=!1,l.isPro=!1,l.done=!1,l.newUser={personaFisica:{telefonosA:[],domicilios:[]}},r.getMap().then(function(e){l.map=e}),l.login=function(){t.login(l.credenciales).then(function(e){l.wrongUserError=!1,localStorage.setItem("id_token",e.jwt),o.decoded=i.decodeToken(e.jwt),o.user=o.decoded.sub.usuario;var t={};t=o.user.admin?o.user.admin.personaFisica:o.user.profesional?o.user.profesional.personaFisica:o.user.afiliado.personaFisica,t.initials=t.nombre[0].toUpperCase()+t.apellido[0].toUpperCase(),o.setStorage("profile",t),o.hasRole("ADMIN")?n.go("admin"):n.go("app")},function(e){l.wrongUserError=!0})},l.forgotPass=function(){t.forgot(l.forgot).then(function(e){n.go("app")})},l.resetPass=function(){t.reset(l.forgot).then(function(e){n.go("app")})},l.removeDom=function(e){l.newUser.personaFisica.domicilios.splice(e,1)},l.addTel=function(){l.newUser.personaFisica.telefono&&""!==l.newUser.personaFisica.telefono&&(l.newUser.personaFisica.telefonosA.push(l.newUser.personaFisica.telefono),l.newUser.personaFisica.telefono="")},l.removeTel=function(e){l.newUser.personaFisica.telefonosA.splice(e,1)},l.validateSave=function(){if(0!==l.newUser.personaFisica.telefonosA.length){if(0!==l.newUser.personaFisica.domicilios.length)return!0;s.error("Ingrese al menos una direccion.")}else s.error("Ingrese al menos un telefono.");return!1},l.saveNew=function(){l.newUser.personaFisica.telefonos=l.newUser.personaFisica.telefonosA.toString(),l.validateSave()&&t.signUp(l.newUser,Boolean(l.isPro)).then(function(){l.done=!0})},l.placeChanged=function(){for(var e=this.getPlace(),o={street_number:{type:"short_name",name:"numero"},route:{type:"long_name",name:"calle"},locality:{type:"short_name",name:"localidad"},administrative_area_level_1:{type:"long_name",name:"provincia"},country:{type:"long_name",name:"pais"},postal_code:{type:"short_name",name:"cp"}},t={},n=0;n<e.address_components.length;n++){var i=e.address_components[n].types[0];if(o[i]){var a=e.address_components[n][o[i].type];t[o[i].name]=a}}t.latitud=e.geometry.location.lat(),t.longitud=e.geometry.location.lng(),t.coordenadas=e.geometry.location.lat()+","+e.geometry.location.lng(),l.newUser.personaFisica.domicilios.push(t),l.afilDir=""},l.registrarse=function(){t.signUp(l.credenciales).then(function(e){localStorage.setItem("id_token",e.jwt),o.decoded=i.decodeToken(e.jwt),o.user=o.decoded.sub.usuario,o.setStorage("profile",o.decoded.sub.usuario),n.go("app")})}}function profesionalesService(e,o){function t(){return o.get(apiRoute+"/profesionales/").then(function(e){return e.data})}function n(){return o.get(apiRoute+"/coordenadas/").then(function(e){return e.data})}function i(e){return e.isProfesional=!0,o.post(apiRoute+"/users/register",e).then(function(e){return e.data})}function a(e){return o.put(apiRoute+"/profesionales/",e).then(function(e){return e.data})}return{getList:t,coordenadas:n,create:i,update:a}}function profesionalesCtrl(e,o,t,n,i,a){var r=this;r.profesionales=[],r.profesionalesOrig=[],r.modalPro={},r.tableConfig={maxPages:"10",itemsPerPage:"8"},i.getMap().then(function(e){r.map=e}),r.filterList=function(){var e=r.query.toLowerCase();r.profesionales=r.profesionalesOrig.filter(function(o){if(-1!==o.matricula.toLowerCase().indexOf(e)||-1!==o.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.personaFisica.apellido.toLowerCase().indexOf(e))return o})},r.view=function(e){r.modalPro=e,$("#viewModal").modal()},r.updateList=function(){t.getList().then(function(e){r.profesionales=e,r.profesionalesOrig=e})},r.removeDom=function(e){r.modalPro.personaFisica.domicilios.splice(e,1)},r.addTel=function(){r.modalPro.personaFisica.telefonosA.push(r.modalPro.personaFisica.telefono),r.modalPro.personaFisica.telefono=""},r.removeTel=function(e){r.modalPro.personaFisica.telefonosA.splice(e,1)},r.newPro=function(){r.modalPro={personaFisica:{domicilios:[],telefonosA:[]}},$("#newModal").modal()},r.edit=function(e){r.modalPro=angular.copy(e),r.modalPro.personaFisica.telefonos?r.modalPro.personaFisica.telefonosA=r.modalPro.personaFisica.telefonos.split(","):r.modalPro.personaFisica.telefonosA=[],r.modalPro.personaFisica.fechaNacimiento&&(r.modalPro.personaFisica.nacimiento=new Date(r.modalPro.personaFisica.fechaNacimiento)),$("#editModal").modal()},r.saveEdit=function(){r.validateSave()&&(r.modalPro.personaFisica.telefonos=r.modalPro.personaFisica.telefonosA.toString(),r.modalPro.personaFisica.fechaNacimiento=r.modalPro.personaFisica.nacimiento,t.update(r.modalPro).then(function(){r.modalPro={},$("#editModal").modal("hide"),r.updateList()}))},r.savePro=function(){r.validateSave()&&(r.modalPro.personaFisica.telefonos=r.modalPro.personaFisica.telefonosA.toString(),t.create(r.modalPro).then(function(){r.modalPro={},$("#newModal").modal("hide"),r.updateList()}))},r.validateSave=function(){if(0!==r.modalPro.personaFisica.telefonosA.length){if(0!==r.modalPro.personaFisica.domicilios.length)return!0;a.error("Ingrese al menos una direccion.")}else a.error("Ingrese al menos un telefono.");return!1},r.placeChanged=function(){for(var e=this.getPlace(),o={street_number:{type:"short_name",name:"numero"},route:{type:"long_name",name:"calle"},locality:{type:"short_name",name:"localidad"},administrative_area_level_1:{type:"long_name",name:"provincia"},country:{type:"long_name",name:"pais"},postal_code:{type:"short_name",name:"cp"}},t={},n=0;n<e.address_components.length;n++){var i=e.address_components[n].types[0];if(o[i]){var a=e.address_components[n][o[i].type];t[o[i].name]=a}}t.latitud=e.geometry.location.lat(),t.longitud=e.geometry.location.lng(),t.coordenadas=e.geometry.location.lat()+","+e.geometry.location.lng(),r.modalPro.personaFisica.domicilios.push(t),r.afilDir=""},r.updateList()}function pacientesService(e,o){function t(){return o.get(apiRoute+"/afiliados/").then(function(e){return e.data})}function n(e){return o.get(apiRoute+"/afiliados/"+e._id).then(function(e){return e.data})}function i(e){return o.post(apiRoute+"/users/register",e).then(function(e){return e.data})}function a(e){return o.put(apiRoute+"/afiliados/",e).then(function(e){return e.data})}function r(e){return o.delete(apiRoute+"/afiliados/"+e._id).then(function(e){return e.data})}return{list:t,get:n,create:i,update:a,remove:r}}function pacientesCtrl(e,o,t,n,i){var a=this;a.afiliados=[],a.afiliadosOrg=[],a.modalAfil={},a.afilSel={},a.tableConfig={maxPages:"10",itemsPerPage:"8"},n.getMap().then(function(e){a.map=e}),a.filterList=function(){var e=a.query.toLowerCase();a.afiliados=a.afiliadosOrg.filter(function(o){if(o.personaFisica&&(-1!==o.personaFisica.nroDocumento.toLowerCase().indexOf(e)||-1!==o.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.personaFisica.apellido.toLowerCase().indexOf(e)))return o})},a.updateList=function(){o.list().then(function(e){a.afiliados=e,a.afiliadosOrg=e})},a.removeDom=function(e){a.modalAfil.afiliado?a.modalAfil.afiliado.domicilios.splice(e,1):a.afilSel.personaFisica.domicilios.splice(e,1)},a.addTel=function(){a.modalAfil.afiliado?a.modalAfil.afiliado.telefono&&""!==a.modalAfil.afiliado.telefono&&(a.modalAfil.afiliado.telefonosA.push(a.modalAfil.afiliado.telefono),a.modalAfil.afiliado.telefono=""):a.afilSel.personaFisica.telefono&&""!==a.afilSel.personaFisica.telefono&&(a.afilSel.personaFisica.telefonosA.push(a.afilSel.personaFisica.telefono),a.afilSel.personaFisica.telefono="")},a.removeTel=function(e){a.modalAfil.afiliado?a.modalAfil.afiliado.telefonosA.splice(e,1):a.afilSel.personaFisica.telefonosA.splice(e,1)},a.viewAfil=function(e){a.afilSel=e,$("#viewModal").modal()},a.edit=function(e){a.afilSel=angular.copy(e),a.afilSel.personaFisica.telefonos?a.afilSel.personaFisica.telefonosA=a.afilSel.personaFisica.telefonos.split(","):a.afilSel.personaFisica.telefonosA=[],a.afilSel.personaFisica.fechaNacimiento&&(a.afilSel.personaFisica.nacimiento=new Date(a.afilSel.personaFisica.fechaNacimiento)),$("#editModal").modal()},a.saveEdit=function(){a.validateSave()&&(a.afilSel.personaFisica.telefonos=a.afilSel.personaFisica.telefonosA.toString(),a.afilSel.personaFisica.fechaNacimiento=a.afilSel.personaFisica.nacimiento,o.update(a.afilSel).then(function(){a.afilSel={},$("#editModal").modal("hide"),a.updateList()}))},a.validateSave=function(){if(0!==a.afilSel.personaFisica.telefonosA.length){if(0!==a.afilSel.personaFisica.domicilios.length)return!0;i.error("Ingrese al menos una direccion.")}else i.error("Ingrese al menos un telefono.");return!1},a.saveAfil=function(){a.validateSave()&&(a.modalAfil.afiliado.telefonos=a.modalAfil.afiliado.telefonosA.toString(),o.create(a.modalAfil).then(function(e){a.modalAfil={},$("#newModal").modal("hide"),a.updateList()}))},a.newAfil=function(){a.modalAfil={afiliado:{domicilios:[],telefonosA:[]}},$("#newModal").modal()},a.placeChanged=function(){for(var e=this.getPlace(),o={street_number:{type:"short_name",name:"numero"},route:{type:"long_name",name:"calle"},locality:{type:"short_name",name:"localidad"},administrative_area_level_1:{type:"long_name",name:"provincia"},country:{type:"long_name",name:"pais"},postal_code:{type:"short_name",name:"cp"}},t={},n=0;n<e.address_components.length;n++){var i=e.address_components[n].types[0];if(o[i]){var r=e.address_components[n][o[i].type];t[o[i].name]=r}}t.latitud=e.geometry.location.lat(),t.longitud=e.geometry.location.lng(),t.coordenadas=e.geometry.location.lat()+","+e.geometry.location.lng(),a.modalAfil.afiliado.domicilios.push(t),a.afilDir=""},a.updateList()}function solicitudesService(e,o){function t(){return o.get(apiRoute+"/solicitudesMedicas/").then(function(e){return e.data})}function n(){return o.get(apiRoute+"/solicitudesMedicas/active").then(function(e){return e.data})}function i(e){return o.get(apiRoute+"/solicitudesMedicas/ruta/profesional/"+e).then(function(e){return e.data})}function a(e){return o.get(apiRoute+"/solicitudesMedicas/ruta/"+e).then(function(e){return e.data})}function r(e){return o.post(apiRoute+"/solicitudesMedicas/setProfesional",e).then(function(e){return e.data})}function s(e){return o.get(apiRoute+"/antecedentesMedicos/cieautocomplete?term="+e).then(function(e){return e.data})}function l(e){return o.get(apiRoute+"/antecedentesMedicos/afiliadoautocomplete?term="+e).then(function(e){return e.data})}function c(e){return o.post(apiRoute+"/solicitudesMedicas/",e).then(function(e){return e.data})}function u(e){return o.put(apiRoute+"/solicitudesMedicas/profesional/finalizarSolicitud",e).then(function(e){return e.data})}return{list:t,listActive:n,calcularRutaProfesional:i,calcularRutaSolicitud:a,setProfesional:r,autocompleteCie10:s,autocompleteAfiliado:l,create:c,finalizar:u}}function solicitudesCtrl(e,o,t,n){var i=this;i.solicitudes=[],i.solicitudesOrig=[],i.modalPro={sintomas:[],antecedentes:[]},i.objSel={},i.tableConfig={maxPages:"10",itemsPerPage:"8"},i.newModal="",i.filterList=function(){var e=i.query.toLowerCase();i.solicitudes=i.solicitudesOrig.filter(function(o){if(-1!==o.afiliado.personaFisica.nombre.toLowerCase().indexOf(e)||-1!==o.afiliado.personaFisica.apellido.toLowerCase().indexOf(e))return o})},i.updateList=function(){o.list().then(function(e){i.solicitudes=e,i.solicitudesOrig=e})},i.newSol=function(){i.modalPro={sintomas:[],antecedentes:[]},$(i.newModal).modal()},i.view=function(e){i.objSel=e,$("#viewModal").modal()},i.finishSave=function(){i.modalPro={sintomas:[],antecedentes:[]},i.updateList(),$(i.newModal).modal("hide")},i.updateList()}var apiRoute="http://apivimedo.us-east-1.elasticbeanstalk.com",client="http://test.vimedo.com.s3-website-us-east-1.amazonaws.com",monthsShortDot$1="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),monthsShort$2="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");moment.defineLocale("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,o){return e?/-MMM-/.test(o)?monthsShort$2[e.month()]:monthsShortDot$1[e.month()]:monthsShortDot$1},monthsParseExact:!0,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},dayOfMonthOrdinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}}),angular.module("vimedo",["ui.router","angular-jwt","angular-growl","angular-table","ngAvatar","blockUI","ngMap","ngAnimate","ui.bootstrap.datetimepicker","ui.bootstrap","angularMoment"]).run(["$rootScope","$state","authManager","jwtHelper","$anchorScroll","growl",function(e,o,t,n,i,a){e.hideNav=!1,e.navTitle="",e.active=o.current.name,t.isAuthenticated()&&!e.user&&(e.user=n.decodeToken(localStorage.getItem("id_token")).sub.usuario),e.setStorage=function(e,o){localStorage.setItem(e,JSON.stringify(o))},e.getStorage=function(e){return JSON.parse(localStorage.getItem(e))},e.logout=function(){localStorage.removeItem("id_token"),localStorage.removeItem("profile"),e.user=!1,o.go("app.login")},e.hasRole=function(o){if(e.user&&e.user.rolName){if("string"==typeof e.user.rolName)return e.user.rolName===o;for(var t in e.user.rolName)if(e.user.rolName[t]===o)return!0}return!1},e.hasAnyRole=function(o){if(e.user&&e.user.rolName)for(var t in o){if("string"==typeof e.user.rolName)return e.user.rolName===o[t];for(var n in e.user.rolName)if(e.user.rolName[n]===o[t])return!0}return!1},e.findByAttr=function(e,o,t){return e.filter(function(e){return e[t]===o&&e})[0]},t.checkAuthOnRefresh(),t.redirectWhenUnauthenticated(),e.$on("tokenHasExpired",function(){e.logout()}),e.getEstado=function(e){return 0===e?"Pendiente":1===e?"En Curso":2===e?"Cerrado":void 0},e.$on("$stateChangeStart",function(t,n,r,s,l){e.profile=e.getStorage("profile"),e.hideNav=!1,e.hideGrowl=n.data&&n.data.hideGrowl,(n.data&&n.data.requiresLogin&&!e.user||n.data&&n.data.requiresRole&&!e.hasAnyRole(n.data.requiresRole))&&(a.error("acceso no autorizado"),t.preventDefault(),o.go("app.login"),$(".modal").modal("hide")),i(0)}),e.$on("$stateChangeSuccess",function(t,n,i,a,r){n.data&&n.data.pageTitle&&(e.navTitle=n.data.pageTitle),e.active=o.current.name,$("body").removeClass("sidebar-open"),e.user||"app.signup"===o.current.name||o.go("app.login")}),e.$on("$stateNotFound",function(e,t,n,i){o.go("app")}),e.$on("$stateChangeError",function(e,t,n,i,a,r){o.go("app")}),e.showWait=function(){e.loading=!0},e.dismissWait=function(){e.loading=!1}}]).factory("httpInerceptor",["$q","growl","$rootScope",function(e,o,t){return{response:function(n){return 406!==n.data.status&&n.data.message&&o.success(n.data.message),t.block=!1,n||e.when(n)},responseError:function(n){var i;return 406==n.status?i=n.data.message:403==n.status?t.logout():i="Ocurrio un error inesperado.",o.error(i),e.reject(n)}}}]).config(["$httpProvider","jwtOptionsProvider","growlProvider","blockUIConfig",function(e,o,t,n){o.config({whiteListedDomains:["localhost",apiRoute],unauthenticatedRedirector:["$state","growl",function(e,o){e.go("app.login"),o.warning("Su sesi&oacute;n ha expirado.")}],loginPath:"app.login",tokenGetter:["options",function(e){return e&&e.url&&".html"==e.url.substr(e.url.length-5)?null:localStorage.getItem("id_token")}]}),e.interceptors.push("jwtInterceptor"),e.interceptors.push("httpInerceptor"),t.globalTimeToLive(3e3),t.globalDisableCountDown(!0),t.globalDisableIcons(!0),n.template='<div class="cssload-container"><div class="cssload-speeding-wheel"></div></div>'}]).filter("unsafe",["$sce",function(e){return e.trustAsHtml}]).filter("splitComma",function(){return function(e){var o="string"==typeof e?e.split(","):e,t=0,n="";return o.map(function(e){n+=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()+",",t%2==1&&t!==o.length-1&&(n+="<br>"),t++}),n.substring(0,n.length-1)}}).filter("replaceCommaSpace",function(){return function(e){if(e)return e.replace(/,/g," ")}}).filter("monthNameUC",function(){return function(e){var o=new Date(e);return months.short[o.getMonth()].toUpperCase()}}).filter("year",function(){return function(e){return new Date(e).getFullYear()}}).filter("fullDateShort",function(){return function(e){var o=new Date(e);return o.getDate()+" "+months.short[o.getMonth()]+" "+o.getFullYear()}}).filter("upperCaseFL",function(){return function(e){if(e){var o=e.split(" ");for(var t in o)o[t]=o[t].charAt(0).toUpperCase()+o[t].slice(1).toLowerCase();return o.join(" ")}}}).directive("ngEnter",function(){return function(e,o,t){o.bind("keydown keypress",function(o){13===o.which&&(o.preventDefault(),e.$apply(function(){e.$eval(t.ngEnter,{event:o})}))})}}).directive("convertToNumber",function(){return{require:"ngModel",link:function(e,o,t,n){n.$parsers.push(function(e){return null!=e?parseInt(e,10):null}),n.$formatters.push(function(e){return null!=e?""+e:null})}}}),angular.module("vimedo").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,o,t){o.otherwise("/"),e.state("app",{url:"/",views:{"@":{templateUrl:"templates/layout.html"},"navView@app":{templateUrl:"templates/nav.html",controller:"navCtrl as ctrl"},"sidemenu@app":{templateUrl:"templates/sidemenu.html",controller:"navCtrl as ctrl"},"contentView@app":{templateUrl:"templates/index.html",controller:"indexCtrl as ctrl"}}}).state("app.login",{url:"login",views:{"loginView@app":{templateUrl:"templates/login.html",controller:"authCtrl as ctrl"}}}).state("app.signup",{url:"registro",views:{"loginView@app":{templateUrl:"templates/signup.html",controller:"authCtrl as ctrl"}}}).state("admin",{url:"/",views:{"@":{templateUrl:"templates/layout.html"},"navView@admin":{templateUrl:"templates/nav.html",controller:"navCtrl as ctrl"},"sidemenu@admin":{templateUrl:"templates/sidemenu.html",controller:"navCtrl as ctrl"}}}).state("admin.pacientes",{url:"pacientes",views:{"contentView@admin":{templateUrl:"templates/admin/pacientes.html",controller:"pacientesCtrl as ctrl"}},data:{requiresLogin:!0,requiresRole:["ADMIN"]}}).state("admin.medicos",{url:"profesionales",views:{"contentView@admin":{templateUrl:"templates/admin/medicos.html",controller:"profesionalesCtrl as ctrl"}},data:{requiresLogin:!0,requiresRole:["ADMIN"]}}).state("admin.historial",{url:"historial",views:{"contentView@admin":{templateUrl:"templates/admin/historial.html",controller:"solicitudesCtrl as ctrl"}},data:{requiresLogin:!0,requiresRole:["ADMIN"]}}),t.html5Mode(!0)}]),angular.module("vimedo").factory("indexService",["$rootScope","$http",indexService]),angular.module("vimedo").controller("indexCtrl",["$scope","$rootScope","indexService","solicitudesService","profesionalesService","$state","$timeout","$compile","NgMap","growl",indexCtrl]),angular.module("vimedo").factory("navService",["$rootScope",navService]),angular.module("vimedo").controller("navCtrl",["$scope","$rootScope","$location","$anchorScroll","navService","$state",navCtrl]),angular.module("vimedo").factory("authService",["$rootScope","$http",authService]),angular.module("vimedo").controller("authCtrl",["$scope","$rootScope","authService","$state","jwtHelper","$timeout","NgMap","growl",authCtrl]),angular.module("vimedo").factory("profesionalesService",["$rootScope","$http",profesionalesService]),angular.module("vimedo").controller("profesionalesCtrl",["$scope","$rootScope","profesionalesService","$state","NgMap","growl",profesionalesCtrl]),angular.module("vimedo").factory("pacientesService",["$rootScope","$http",pacientesService]),angular.module("vimedo").controller("pacientesCtrl",["$rootScope","pacientesService","$state","NgMap","growl",pacientesCtrl]),angular.module("vimedo").factory("solicitudesService",["$rootScope","$http",solicitudesService]),angular.module("vimedo").controller("solicitudesCtrl",["$rootScope","solicitudesService","$state","growl",solicitudesCtrl]),angular.module("vimedo").component("modalNuevaSolicitud",{templateUrl:"./components/modal-nueva-solicitud.html",bindings:{modal:"&",obj:"<",finishAction:"&"},controller:["solicitudesService","growl",function(e,o){var t=this;this.$onInit=function(){t.uniqueId=String(performance.now()).replace(".",""),t.modal({modal:"#modal_"+t.uniqueId})},t.autocompleteCie=function(o){return e.autocompleteCie10(o).then(function(e){return e})},t.autocompleteAfil=function(o){return e.autocompleteAfiliado(o).then(function(e){return e})},t.selectSintoma=function(e,o){e&&e.dec10&&(o?t.obj.antecedentes.push(e):t.obj.sintomas.push(e)),!e&&(!o&&""!==t.asyncSelected||o&&""!==t.asyncSelectedA)&&(o?t.obj.antecedentes.push({dec10:t.asyncSelectedA}):t.obj.sintomas.push({dec10:t.asyncSelected})),t.asyncSelected="",t.asyncSelectedA=""},t.removeSintoma=function(e,o){o?t.obj.antecedentes.splice(e,1):t.obj.sintomas.splice(e,1)},t.savePro=function(){if(t.obj.afiliado)if(t.obj.domicilioSel)if(t.obj.sintomas&&0!==t.obj.sintomas.length){var n=[],i=[],a=[],r=[];t.obj.sintomas.map(function(e){e._id?n.push(e._id):i.push(e.dec10)}),t.obj.antecedentes.map(function(e){e._id?a.push(e._id):r.push(e.dec10)});var s={sintomas:i.toString(),sintomasCie:n,horasSintomas:t.obj.horasSintomas?t.obj.horasSintomas:0,minutosSintomas:t.obj.minutosSintomas?t.obj.minutosSintomas:0,afiliado:t.obj.afiliado._id,domicilio:t.obj.domicilioSel._id,antecedentesCie:a,antecedentes:r.toString()};e.create(s).then(function(){t.finishAction()})}else o.error("Seleccione por lo menos un sintoma.");else o.error("Seleccione por lo menos un domicilio.");else o.error("Seleccione un afiliado.")}}]});
//# sourceMappingURL=maps/app.js.map
